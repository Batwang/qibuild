v3.2
=====

Command line
------------

* New command added: ``qitest``. This makes it possible to run the tests after
  they have been deployed to a remote host (assuming qibuild is installed on the
  remote host)

.. code-block:: console

  qibuild deploy --with-tests user@host:deploy
  ssh use@host
  cd deploy
  qitest run qitest.json

* Better handling of concurrency:

  * ``ctrl-c`` can no longer cause deadlocks.
  * ``qibuild test`` displays a summary even when it has been interrupted
  * Python exceptions raised during tests no longer cause deadlocks.

* Better error message when CMake segfaults

* cmake: check that headers and libs are consistent. (For instance, boost headers
  found in ``/usr/include``, and boost libs in ``/path/to/toolchain/boost/lib``)


* Sort projects and packages lists in qibuild deploy


qidoc
-----

* Output where the doc has been built


Packaging
----------

* Switch to ``setuptools``.

  * Fixes using ``qidoc`` after using ``pip`` to install ``qibuild``
  * Fixes using ``pip install qibuild`` on Windows

qisrc
-----

* ``git.is_git``: optimize detection: does .git exist?

* ``qisrc sync``: do not crash when fetch fails

* ``qisrc snapshot``: handle badly formatted snapshot file

Python
------

* Rewrite of the ``qibuild test`` implementation

  * Removed ``qibuild.ctest`` and  ``qibuild.performance``
  * Added ``qitest`` module, ``qibuild.test_runner`` and ``BuildProject.run_tests``

CMake
------

* Added ``qi_create_test_helper`` : this will create an executable that
  will be built when the tests are built, but is not an actual tests.
  Useful to create several tests with the same executable but different arguments:

.. code-block:: cmake

    # old:

    qi_create_test(foo foo.cpp NO_ADD_TEST)
    qi_add_test(foo_bar foo ARGUMENTS --bar)
    qi_add_test(foo_baz foo ARGUMENTS --baz)

.. code-block:: cmake

    # new:

    qi_create_test_helper(foo foo.cpp)
    qi_add_test(foo_bar foo ARGUMENTS --bar)
    qi_add_test(foo_baz foo ARGUMENTS --baz)

* Changed options:

  ``BUILD_TESTS`` is no longer used, use ``QI_WITH_TESTS=OFF`` instead to
  deactivate the tests completely (they won't even be configured)

* The implementation no longer calls upstream's ``add_test``, which means:

  * You cannot use ``ctest`` or ``make test`` to run the tests
  * The call to ``enable_testing()`` is no longer necessary

* ``qi_swig_java``: add ``OUTDIR`` parameter, used to specify where swig will
  generate data.

* qibuild cmake modules:

  * ``boostutils``: fix for cmake > 2.8.11
